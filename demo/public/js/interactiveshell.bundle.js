(()=>{"use strict";var e={834(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(620),t),s(n(449),t),s(n(540),t),s(n(432),t),s(n(16),t),s(n(908),t),s(n(870),t),s(n(858),t),s(n(980),t)},620(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.AdbClient=void 0;const s=n(858),o=n(351),r=n(449),a=n(908),c=n(16),d=n(364),u=n(681);class h{constructor(e,t,n){this.transport=e,this.options=t,this.keyStore=n,this.messageQueue=new d.AsyncBlockingQueue,this.openStreams=new Set,this.messageChannel=new s.MessageChannel(e,t,this)}registerStream(e){this.openStreams.add(e)}unregisterStream(e){this.openStreams.delete(e)}newMessage(e){const t=Array.from(this.openStreams);for(const n of t)if(n.consumeMessage(e))return;this.messageQueue.enqueue(e)}awaitMessage(){return i(this,void 0,void 0,function*(){return this.messageQueue.dequeue()})}connect(){return i(this,void 0,void 0,function*(){const e=this.options.useChecksum?16777216:16777217,t=s.Message.cnxn(e,262144,"host::\0",this.options.useChecksum);let n;yield this.sendMessage(t);do{n=yield this.awaitMessage()}while("CNXN"!==n.header.cmd&&"AUTH"!==n.header.cmd);if("CNXN"===n.header.cmd){if(!n.data)throw new Error("Connection doesn't have data");return r.AdbConnectionInformation.fromDataView(n.data)}if(n=yield this.doAuth(n),!n.data)throw new Error("Connection doesn't have data");return r.AdbConnectionInformation.fromDataView(n.data)})}disconnect(){return i(this,void 0,void 0,function*(){this.messageChannel.close()})}shell(e){return i(this,void 0,void 0,function*(){const t=yield a.Stream.open(this,`shell:${e}`,this.options),n=yield t.read();return yield t.close(),n.dataAsString()||""})}framebuffer(){return i(this,void 0,void 0,function*(){return u.Framebuffer.create(this,this.options)})}interactiveShell(e){return i(this,void 0,void 0,function*(){const t=yield a.Stream.open(this,"shell:",this.options);return new c.Shell(t,e)})}sync(){return i(this,void 0,void 0,function*(){return yield a.Stream.open(this,"sync:",this.options)})}pull(e){return i(this,void 0,void 0,function*(){const t=yield this.sync(),n=yield t.pull(e);return yield t.close(),n})}push(e,t,n,s){return i(this,void 0,void 0,function*(){const i=yield this.sync();yield i.push(e,t,n,s),yield i.close()})}doAuth(e){return i(this,void 0,void 0,function*(){if("AUTH"!==e.header.cmd)throw new Error("Not an AUTH response");if(1!==e.header.arg0)throw new Error(`\n          Invalid AUTH parameter. Expected 1 and received ${e.header.arg0}`);if(!e.data)throw new Error("AUTH message doens't contain data");const t=e.data.buffer,n=yield this.keyStore.loadKeys();for(const e of n){const n=yield crypto.subtle.sign("RSASSA-PKCS1-v1_5",e.privateKey,t),i=s.Message.authSignature(new DataView(n),this.options.useChecksum);yield this.sendMessage(i);const o=yield this.awaitMessage();if("CNXN"===o.header.cmd)return o;console.log("Received message ",o,"from phone")}const i=yield h.generateKey(this.options.dump,this.options.keySize);yield this.keyStore.saveKey(i);const o=new DataView(yield crypto.subtle.exportKey("spki",i.publicKey)),r=s.Message.authPublicKey(o,this.options.useChecksum);yield this.sendMessage(r),this.options.debug&&console.log("Waiting for key to be accepted on the device.");const a=yield this.awaitMessage();if("CNXN"!==a.header.cmd)throw console.error("AUTH failed. Phone didn't accept key",a),new Error("AUTH failed. Phone didn't accept key");return a})}sendMessage(e){return i(this,void 0,void 0,function*(){yield this.messageChannel.write(e)})}static generateKey(e,t){return i(this,void 0,void 0,function*(){const n=e,i=yield crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},n,["sign","verify"]);return e&&(yield(0,o.privateKeyDump)(i)),i})}}t.AdbClient=h},449(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AdbConnectionInformation=void 0;const n="<unkwnown>";class i{constructor(e,t,n,i){this.productName=e,this.productDevice=t,this.productModel=n,this.features=i}static fromDataView(e){const t=(new TextDecoder).decode(e);return i.fromString(t)}static fromString(e){const t=e.indexOf("::"),s=e.substring(t+2).split(";");let o=n,r=n,a=n,c=[];for(const e of s)e.startsWith("ro.product.name")?o=e.substring(16):e.startsWith("ro.product.model")?a=e.substring(17):e.startsWith("ro.product.device")?r=e.substring(18):e.startsWith("features")&&(c=e.substring(9).split(","));return new i(o,r,a,c)}}t.AdbConnectionInformation=i},681(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.Framebuffer=void 0;const s=n(908);class o{constructor(e,t,n,i,s,o,r,a,c,d,u,h,l,f,y){this.version=e,this.bpp=t,this.colorSpace=n,this.size=i,this.width=s,this.height=o,this.redOffset=r,this.redLength=a,this.blueOffset=c,this.blueLength=d,this.greenOffset=u,this.greenLength=h,this.alphaOffset=l,this.alphaLength=f,this.imageData=y}static create(e,t){return i(this,void 0,void 0,function*(){var n;const i=yield s.Stream.open(e,"framebuffer:",t);let r=yield i.read();if("WRTE"!==r.header.cmd)throw yield i.write("CLSE"),new Error(`Expected WRTE message but received ${r.header.cmd}`);if(!r.data)throw yield i.write("CLSE"),new Error("message doesn't contain data");yield i.write("OKAY");const a=r.data.getUint32(0,!0),c=r.data.getUint32(4,!0),d=r.data.getUint32(8,!0),u=r.data.getUint32(12,!0),h=r.data.getUint32(16,!0),l=r.data.getUint32(20,!0),f=r.data.getUint32(24,!0),y=r.data.getUint32(28,!0),g=r.data.getUint32(32,!0),w=r.data.getUint32(36,!0),v=r.data.getUint32(40,!0),p=r.data.getUint32(44,!0),m=r.data.getUint32(48,!0),b=r.data.getUint32(52,!0),E=new Uint8Array(u);let M=0,_=new Uint8Array(r.data.buffer.slice(o.BYTE_LENGTH));for(E.set(_,0),M=_.length;M<u&&(r=yield i.read(),"CLSE"!==r.header.cmd);){if(!r.data)throw yield i.write("CLSE"),new Error("message doesn't contain data");_=new Uint8Array(null===(n=r.data)||void 0===n?void 0:n.buffer),E.set(_,M),M+=_.length,yield i.write("OKAY")}return yield i.close(),new o(a,c,d,u,h,l,f,y,g,w,v,p,m,b,Uint8ClampedArray.from(E))})}}t.Framebuffer=o,o.BYTE_LENGTH=56},351(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((i=i.apply(e,t||[])).next())})};function i(e,t,n){const i=t-e.length;let s="";for(let e=0;e<i;e++)s+=n;return s+e}function s(e){return i(e.toString(16),2,"0")}function o(e){return i(e.toString(16),4,"0")}function r(e){return btoa(new Uint8Array(e).reduce((e,t)=>e+String.fromCharCode(t),""))}Object.defineProperty(t,"__esModule",{value:!0}),t.toHex8=s,t.toHex16=o,t.toHex32=function(e){return i(e.toString(16),8,"0")},t.hexdump=function(e,t=""){const n=new TextDecoder;for(let i=0;i<e.byteLength;i+=16){const r=e.byteLength-i>16?16:e.byteLength-i;let a,c=t+o(i)+" ";for(a=0;a<r;a++)c+=" "+s(e.getUint8(i+a));for(;a<16;a++)c+="   ";c+=" | "+n.decode(new DataView(e.buffer,i,r)),console.log(c)}},t.toB64=r,t.privateKeyDump=function(e){return n(this,void 0,void 0,function*(){if(!e.privateKey.extractable)return void console.log("cannot dump the private key, it's not extractable");const t=yield crypto.subtle.exportKey("pkcs8",e.privateKey);console.log(`-----BEGIN PRIVATE KEY-----\n${r(t)}\n-----END PRIVATE KEY-----`)})},t.publicKeyDump=function(e){return n(this,void 0,void 0,function*(){if(!e.publicKey.extractable)return void console.log("cannot dump the public key, it's not extractable");const t=yield crypto.subtle.exportKey("spki",e.publicKey);console.log(`-----BEGIN PUBLIC KEY-----\n${r(t)}'\n-----END PUBLIC KEY-----`)})},t.encodeCmd=function(e){const t=(new TextEncoder).encode(e).buffer;return new DataView(t).getUint32(0,!0)},t.decodeCmd=function(e){const t=new TextDecoder,n=new ArrayBuffer(4);return new DataView(n).setUint32(0,e,!0),t.decode(n)}},540(e,t){Object.defineProperty(t,"__esModule",{value:!0})},432(e,t){Object.defineProperty(t,"__esModule",{value:!0})},364(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncBlockingQueue=t.Queue=void 0;class i{constructor(e){this.data=e}}class s{enqueue(e){const t=new i(e);this.tail&&(this.tail.next=t),this.tail=t,this.head||(this.head=this.tail)}dequeue(){if(this.isEmpty())throw new Error("Cannot dequeue. Queue is empty");const e=this.head.data;return this.head=this.head.next,e}isEmpty(){return null==this.head}}t.Queue=s,t.AsyncBlockingQueue=class{constructor(){this.promiseQueue=new s,this.resolverQueue=new s}add(){const e=new Promise(e=>{this.resolverQueue.enqueue(e)});this.promiseQueue.enqueue(e)}enqueue(e){this.resolverQueue.isEmpty()&&this.add(),this.resolverQueue.dequeue()(e)}dequeue(){return n(this,void 0,void 0,function*(){return this.promiseQueue.isEmpty()&&this.add(),this.promiseQueue.dequeue()})}hasPendingPromises(){return!this.promiseQueue.isEmpty()}hasPendingResolvers(){return!this.resolverQueue.isEmpty()}}},16(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.Shell=void 0,t.Shell=class{constructor(e,t){this.stream=e,this.callbackFunction=t,this.textDecoder=new TextDecoder,this.textEncoder=new TextEncoder,this.messageListener=[],this.closed=!1,this.loopRead()}loopRead(){return n(this,void 0,void 0,function*(){try{let e;do{if(e=yield this.stream.read(),"WRTE"===e.header.cmd){this.stream.write("OKAY");const t=this.textDecoder.decode(e.data);this.callbackFunction&&this.callbackFunction(t)}for(const t of this.messageListener)t(e)}while(!this.closed)}catch(e){console.error("loopRead crashed",e)}this.stream.client.unregisterStream(this.stream)})}waitForMessage(e){return new Promise(t=>{const n=i=>{if(i.header.cmd===e){const e=this.messageListener.indexOf(n);this.messageListener.splice(e,1),t(i)}};this.messageListener.push(n)})}write(e){return n(this,void 0,void 0,function*(){const t=this.textEncoder.encode(e);yield this.stream.write("WRTE",new DataView(t.buffer)),yield this.waitForMessage("OKAY")})}close(){return n(this,void 0,void 0,function*(){this.closed=!0,yield this.write("CLSE")})}}},908(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;const s=n(858),o=n(351),r=n(870),a=n(364);class c{constructor(e,t,n,i,s){this.client=e,this.service=t,this.localId=n,this.remoteId=i,this.options=s,this.messageQueue=new a.AsyncBlockingQueue}close(){return i(this,void 0,void 0,function*(){yield this.write("CLSE"),this.options.debug&&(console.log(`Closed stream ${this.service}`),console.log(` local_id: 0x${(0,o.toHex32)(this.localId)}`),console.log(` remote_id: 0x${(0,o.toHex32)(this.remoteId)}`)),this.client.unregisterStream(this)})}consumeMessage(e){return 0!==e.header.arg0&&e.header.arg0===this.remoteId&&0!==e.header.arg1&&e.header.arg1===this.localId&&(this.messageQueue.enqueue(e),!0)}write(e,t){return i(this,void 0,void 0,function*(){const n=this.newMessage(e,t);yield this.client.sendMessage(n)})}read(){return i(this,void 0,void 0,function*(){return this.messageQueue.dequeue()})}sendReceive(e,t){return i(this,void 0,void 0,function*(){yield this.client.sendMessage(e);const n=yield this.read();if(n.header.cmd!==t)throw new Error("WRTE/SEND failed: "+n)})}pull(e){return i(this,void 0,void 0,function*(){const t=(new TextEncoder).encode(e),n=new r.SyncFrame("RECV",t.byteLength),i=this.newMessage("WRTE",n.toDataView());yield this.client.sendMessage(i);const s=yield this.read();if("OKAY"!==s.header.cmd)throw new Error("WRTE/RECV failed: "+s);const o=this.newMessage("WRTE",new DataView(t.buffer));yield this.client.sendMessage(o);const a=yield this.read();if("OKAY"!==a.header.cmd)throw new Error("WRTE/filename failed: "+a);const c=this.newMessage("OKAY");let d=yield this.read();yield this.client.sendMessage(c);let u=r.SyncFrame.fromDataView(new DataView(d.data.buffer.slice(0,8))),h=new Uint8Array(d.data.buffer.slice(8));const l=[];for(;"DONE"!==u.cmd;){for(;u.byteLength>=h.byteLength;){d=yield this.read(),yield this.client.sendMessage(c);const e=h.byteLength+d.data.byteLength,t=new Uint8Array(e);t.set(h,0),t.set(new Uint8Array(d.data.buffer),h.byteLength),h=t}l.push(h.slice(0,u.byteLength).buffer),h=h.slice(u.byteLength),u=r.SyncFrame.fromDataView(new DataView(h.slice(0,8).buffer)),h=h.slice(8)}return new Blob(l)})}push(e,t,n,s){return i(this,void 0,void 0,function*(){const i=new FileReader,o=new TextEncoder,a=o.encode(t),c=new r.SyncFrame("SEND",t.length+1+n.length),d=this.newMessage("WRTE",c.toDataView());yield this.sendReceive(d,"OKAY");const u=this.newMessage("WRTE",new DataView(a.buffer));yield this.sendReceive(u,"OKAY");const h=this.newMessage("WRTE",new DataView(o.encode(","+n).buffer));yield this.sendReceive(h,"OKAY");const l=new Promise((t,n)=>{i.onload=e=>t(e.target.result),i.onerror=n,i.readAsArrayBuffer(e)}),f=yield l,y=[];for(let e=0;e<f.byteLength;e+=s)y.push(f.slice(e,Math.min(e+s,f.byteLength)));for(const e of y){const t=new r.SyncFrame("DATA",e.byteLength),n=this.newMessage("WRTE",t.toDataView());yield this.sendReceive(n,"OKAY");const i=new DataView(e),s=this.newMessage("WRTE",i);yield this.sendReceive(s,"OKAY")}const g=new r.SyncFrame("DONE",Math.round(Date.now()/1e3)),w=this.newMessage("WRTE",g.toDataView());yield this.client.sendMessage(w);const v=this.newMessage("OKAY");yield this.sendReceive(v,"OKAY")})}newMessage(e,t){return s.Message.newMessage(e,this.localId,this.remoteId,this.options.useChecksum,t)}static open(e,t,n){return i(this,void 0,void 0,function*(){const i=c.nextId++;let r=0;const a=s.Message.open(i,r,t,n.useChecksum);let d;yield e.sendMessage(a);do{d=yield e.awaitMessage()}while(d.header.arg1!==i);if("OKAY"!==d.header.cmd)throw new Error("OPEN Failed");r=d.header.arg0,n.debug&&(console.log(`Opened stream ${t}`),console.log(` local_id: 0x${(0,o.toHex32)(i)}`),console.log(` remote_id: 0x${(0,o.toHex32)(r)}`));const u=new c(e,t,i,r,n);return e.registerStream(u),u})}}t.Stream=c,c.nextId=1},870(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.SyncFrame=void 0;const i=n(351);class s{constructor(e,t){this.cmd=e,this.byteLength=t}toDataView(){const e=new ArrayBuffer(8),t=(0,i.encodeCmd)(this.cmd),n=new DataView(e);return n.setUint32(0,t,!0),n.setUint32(4,this.byteLength,!0),n}static fromDataView(e){const t=(0,i.decodeCmd)(e.getUint32(0,!0)),n=e.getUint32(4,!0);return new s(t,n)}}t.SyncFrame=s},397(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Message=void 0;const i=n(864),s=n(351);class o{constructor(e,t){this.header=e,this.data=t}dataAsString(){return this.data?(new TextDecoder).decode(this.data):null}static newMessage(e,t,n,s,r){let a=0,c=0;r&&(c=r.byteLength,s&&(a=o.checksum(r)));const d=new i.MessageHeader(e,t,n,c,a);return new o(d,r)}static open(e,t,n,i){const s=new TextEncoder,r=new DataView(s.encode(n+"\0").buffer);return o.newMessage("OPEN",e,t,i,r)}static cnxn(e,t,n,i){const s=new TextEncoder,r=new DataView(s.encode(n).buffer);return o.newMessage("CNXN",e,t,i,r)}static authSignature(e,t){return o.newMessage("AUTH",2,0,t,e)}static authPublicKey(e,t){const n=(new TextEncoder).encode((0,s.toB64)(e.buffer)+"\0");return o.newMessage("AUTH",3,0,t,new DataView(n.buffer))}static checksum(e){let t=0;for(let n=0;n<e.byteLength;n++)t+=e.getUint8(n);return 4294967295&t}}t.Message=o},734(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageChannel=void 0;const s=n(397),o=n(864);t.MessageChannel=class{constructor(e,t,n){this.transport=e,this.options=t,this.listener=n,this.active=!0,this.readLoop()}readLoop(){return i(this,void 0,void 0,function*(){let e;do{e=yield this.read(),this.options.debug&&console.log("<<<",e),this.listener.newMessage(e)}while(this.active)})}readHeader(){return i(this,void 0,void 0,function*(){const e=yield this.transport.read(24);return o.MessageHeader.parse(e,this.options.useChecksum)})}read(){return i(this,void 0,void 0,function*(){const e=yield this.readHeader();let t;return e.cmd,e.length>0&&(t=yield this.transport.read(e.length)),new s.Message(e,t)})}close(){this.active=!1}write(e){return i(this,void 0,void 0,function*(){this.options.debug&&console.log(">>>",e);const t=e.header.toDataView();yield this.transport.write(t.buffer),e.data&&(yield this.transport.write(e.data.buffer))})}}},864(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHeader=void 0;const i=n(351);class s{constructor(e,t,n,i,s){this.cmd=e,this.arg0=t,this.arg1=n,this.length=i,this.checksum=s}toDataView(){const e=new DataView(new ArrayBuffer(24)),t=(0,i.encodeCmd)(this.cmd),n=4294967295^t;return e.setUint32(0,t,!0),e.setUint32(4,this.arg0,!0),e.setUint32(8,this.arg1,!0),e.setUint32(12,this.length,!0),e.setUint32(16,this.checksum,!0),e.setUint32(20,n,!0),e}static parse(e,t=!1){const n=e.getUint32(0,!0),o=e.getUint32(4,!0),r=e.getUint32(8,!0),a=e.getUint32(12,!0),c=e.getUint32(16,!0);if(t&&e.byteLength>20&&-1!==(n^e.getUint32(20,!0)))throw new Error("magic mismatch");return new s((0,i.decodeCmd)(n),o,r,a,c)}}t.MessageHeader=s},257(e,t){Object.defineProperty(t,"__esModule",{value:!0})},858(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(397),t),s(n(734),t),s(n(864),t),s(n(257),t)},225(e,t){Object.defineProperty(t,"__esModule",{value:!0})},289(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.WebUsbTransport=void 0;const s=n(351),o={classCode:255,subclassCode:66,protocolCode:1},r={classCode:255,subclassCode:66,protocolCode:3},a=[o,r];class c{constructor(e,t,n,i,s,o=console.log){this.device=e,this.match=t,this.endpointIn=n,this.endpointOut=i,this.options=s,this.log=o}close(){return i(this,void 0,void 0,function*(){yield this.device.releaseInterface(this.match.intf.interfaceNumber),yield this.device.close()})}write(e){return i(this,void 0,void 0,function*(){this.options.dump&&(0,s.hexdump)(new DataView(e),this.endpointOut+"==> "),yield this.device.transferOut(this.endpointOut,e)})}read(e){return i(this,void 0,void 0,function*(){const t=yield this.device.transferIn(this.endpointIn,e);if(!t.data)throw new Error("Response didn't contain any data");return t.data})}isAdb(){return null!=c.findMatch(this.device,o)}isFastboot(){return null!=c.findMatch(this.device,r)}static open(e){return i(this,void 0,void 0,function*(){const t=yield navigator.usb.requestDevice({filters:a});yield t.open();const n=this.findMatch(t,o);if(!n)throw new Error("Could not find an ADB device");yield t.selectConfiguration(n.conf.configurationValue),yield t.claimInterface(n.intf.interfaceNumber);const i=c.getEndpointNum(n.alternate.endpoints,"in"),s=c.getEndpointNum(n.alternate.endpoints,"out"),r=new c(t,n,i,s,e);return e.debug&&console.log("Created new Transport: ",r),r})}static findMatch(e,t){for(const n of e.configurations)for(const e of n.interfaces)for(const i of e.alternates)if(t.classCode===i.interfaceClass&&t.subclassCode===i.interfaceSubclass&&t.protocolCode===i.interfaceProtocol)return{conf:n,intf:e,alternate:i};return null}static getEndpointNum(e,t,n="bulk"){for(const i of e)if(i.direction===t&&i.type===n)return i.endpointNumber;throw new Error(`Cannot find ${t} endpoint`)}}t.WebUsbTransport=c},980(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(225),t),s(n(289),t)}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i=n(834),s=function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((i=i.apply(e,t||[])).next())})};const o=document.querySelector("#connect"),r=document.querySelector("#disconnect"),a=document.querySelector("#output"),c=document.querySelector("#input"),d={debug:!0,useChecksum:!1,dump:!1,keySize:2048},u=new class{constructor(){this.keys=[]}loadKeys(){return s(this,void 0,void 0,function*(){return this.keys})}saveKey(e){return s(this,void 0,void 0,function*(){this.keys.push(e),console.log("Saving Key"+e)})}};let h=null,l=null,f=null;function y(e){const t=document.createElement("span");t.innerText=e,a.appendChild(t),a.scrollTop=a.scrollHeight}o.addEventListener("click",e=>s(void 0,void 0,void 0,function*(){try{h=yield i.WebUsbTransport.open(d),l=new i.AdbClient(h,d,u),yield l.connect(),f=yield l.interactiveShell(y),r.classList.toggle("hidden"),o.classList.toggle("hidden")}catch(e){console.error("Connection Failed: ",e)}})),r.addEventListener("click",e=>s(void 0,void 0,void 0,function*(){try{yield null==f?void 0:f.close(),yield null==h?void 0:h.close(),h=null,l=null,f=null}catch(e){console.error("Error closing the connection",e)}r.classList.toggle("hidden"),o.classList.toggle("hidden")})),c.addEventListener("keyup",e=>{return 13!==e.keyCode||(e.preventDefault(),t=c.value,f.write(t+"\n"),c.value="",!1);var t})})();